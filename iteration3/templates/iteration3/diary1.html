﻿{% load static %}
{% if request.session.is_login %}
    <head>
      <!-- BEGIN: Title -->
      <title>Diatastic &mdash; Easily Manage Blood Sugar</title>
      <!-- END: Title -->

      <!-- BEGIN: Meta -->
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <!-- END: Meta -->

      <!-- BEGIN: Favicon -->
      <link rel="shortcut icon" href="/static/images/icons8-rh-plus-gradient-16.png">
      <!-- END: Favicon -->

      <!-- BEGIN: Stylesheets -->
        <!-- Latest compiled and minified CSS -->
      <link rel="stylesheet" href="/static/css/bootstrap/bootstrap.css">
      <link rel="stylesheet" href="/static/css/tiny-slider.css">
      <link rel="stylesheet" href="/static/fonts/lineicons/LineIcons.min.css">
      <link rel="stylesheet" href="/static/fonts/icomoon/style.css">
      <link rel="stylesheet" href="/static/css/animate.min.css">
      <link rel="stylesheet" href="/static/css/jquery.lavalamp.css">
      <link rel="stylesheet" href="/static/css/jquery.fancybox.min.css">
      <link rel="stylesheet" href="/static/css/style.css">
      <link rel="stylesheet" href="/static/css/select.css">
      <!-- END: Stylesheets -->

      <!-- BEGIN: help bot -->
          <!-- meta -->
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1">
    <meta name="keywords" content="pvr, pvr tech studio, css chat box, pvr admin, pvr tech admin"/>
    <meta name="description" content="PVR Tech Studio, We Design your Future.">
        <!-- Add Your favicon here -->
<!--        <link rel="icon" href="../static/assets/img/favicon/favicon-32x32.png">-->
    <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>

    <!-- ***** Boostrap Custom / Addons Stylesheets ***** -->
    <link href="/static/assets/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="/static/assets/plugins/material_icon/icon.css" rel="stylesheet"/>

    <!-- Required CSS file for CSS Chat Panels element -->
    <link href="/static/assets/plugins/perfect-scrollbar/css/perfect-scrollbar.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="/static/assets/css/chat_box.css" type="text/css" media="all">
      <!--END: help bot -->

    </head>

    <body>

      <!-- PAGE HELP BOT -->
      <div class="container perfect_scrollbar" id="container">
          <div class="pvr_chat_button">
              <i class="material-icons">chat</i>
              <span>Help Bot</span>
          </div>
          <div class="pvr_chat_wrapper">
              <div class="pvr_chat_content">
                  <div class="close_chat">
                      <i class="material-icons">close</i>
                  </div>
                  <div class="chat_header">
                      <div class="pvr-user-w with-status status-green">
                          <div class="pvr-user-avatar-w">
                              <div class="user-avatar">
                                  <img alt="" src="/static/assets/img/avatar/default-avatar.jpg">
                              </div>
                          </div>
                          <div class="user-name">
                              <h6 class="user-title">
                                  <a href="#" target="_blank">Help Bot</a>
                              </h6>
                              <div class="user-role">
                                  Administrator
                              </div>
                          </div>
                      </div>
                  </div>
                  <div class="chat-messages theme_2">
                      <div class="message">
                          <div class="message-content">
                            Hi! I'm HelpBot. How can I help you today?
                          </div>
                      </div>
                  </div>
                  <div class="chat-controls">
                      <input class="message-input" id="message-input" placeholder="Type your message here..." type="text">
                      <div class="chat-extra">
                          <a href="javascript:void(0)" class="change_chat_theme">
                              <span class="extra-tooltip">Change chat theme</span>
                              <i class="material-icons">refresh</i>
                          </a>
                      </div>
                  </div>
              </div>
          </div>
      </div>
      <!-- END: help bot -->


      <!-- BEGIN: .site-wrap -->
      <div class="site-wrap">

        <!-- BEGIN: #site-header -->
        <!--
          Add class '.position-relative' to display it as stack.
          Add '.navbar-light' to make the text dark or black.
        -->
        <header id="site-header" class="position-relative">

          <!-- Add '.navbar_dark' class if you want the color of the text to -->
          <nav class="navbar navbar-expand-lg navbar-light">
            <div class="container">

              <!-- BEGIN: .navbar-brand -->
              <a class="navbar-brand" href="/Diary/index/">
              <img src="/static/images/icons8-rh-plus-gradient-32.png" >Diatastic
              </a>
              <!-- END: .navbar-brand -->

              <!-- BEGIN: .navbar-toggler -->
              <a href="#" class="burger-toggle-menu js-burger-toggle-menu ml-auto py-4" data-toggle="collapse" data-target="#main-nav" aria-controls="main-nav" aria-expanded="false" aria-label="Toggle navigation">
                <span></span>
                <span></span>
                <span></span>
              </a>
              <!-- END: .navbar-toggler -->

              <!-- BEGIN: #main-nav -->
              <div class="collapse navbar-collapse" id="main-nav">

                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                    <a class="nav-link" href="/index/">Home</a>
                  </li>
                  <li class="nav-item  active">
                    <a class="nav-link" href="/diary/">Diary</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="/list_view/">History</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="/guide/">Beginner's Guide</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="/tips/">Tips and Tricks</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="/FAQ/">F&Q</a>
                  </li>
                </ul>
                </ul>

              </div>
              <!-- END: #main-nav -->

            </div>
          </nav>
        </header>
        <!-- END: #site-header -->

        <!-- BEGIN: .cover -->
        <div class="page-heading-85912" style="background-image: url('images/hero_bg_3.jpg')">
          <div class="container">
            <div class="row align-items-end">
              <div class="col-lg-7">
                <h1 class="mb-0 heading text-white">Diary</h1>
                <p class="mb-0 text-white">Healthy living starts with your daily diet. </p>
              </div>
            </div>
          </div>
        </div>

        <div class="custom-breadcrumns-23195 border-bottom">
          <div class="container">
            <a href="/Diary/index/">Home</a>
            <span class="mx-3 icon-keyboard_arrow_right"></span>
            <span class="current">Diary</span>
          </div>
        </div>
        <span></span>


<form method="post"
      id = "DiaryForm"
      action = "/diary/"
      data-description-url="{% url 'ajax_load_description' %}"
      data-portion-url="{% url 'ajax_load_portion' %}"
      create_view="{% url 'create_view' %}">
    {% csrf_token %}


    <div class="container">
        <br>
        <div style="text-align: center;">
            <h1>Enter your Diary</h1>
        </div>
<!--    Date Time-->
        <br><br><br>
        <div style="text-align: center;">
            <div style="display: inline-block; width: 200px;">
                <label for="date">Date:</label>
                    <input name="date" id="date" type="date" class="form-control" required="required"/>
              </div>


    <!--      Time field.-->
              <div style="display: inline-block; width: 200px; margin:15px">
                  <label for="time">Time: </label>
                        <input name="time" id="time" type="time" class="form-control" required="required"/>
              </div>
            <br/><br/>
        </div>
<!--      Slider field.-->
        <div style="text-align: center;">
          <div id="bsl_slider" class="form-class numeric-slider" style="display: inline">
              <label for="blood_sugar_level">Blood Sugar Level: </label>
<!--                Number input-->
                    <input name="blood_sugar_level" id="blood_sugar_level" type="number"
                           min = "1" max="30" step="0.1"
                           class="form-control" style="display: inline; width: 80px;"
                           required="required" value="{{blood_sugar_level}}"/>

<!--                Slider input-->
              <span class="font-weight-bold" style="margin-left: 10px">1</span>
                    <input name="blood_sugar_level_slider" id="blood_sugar_level_slider" type="range" min="1" max="30" step="0.1"
                           class="slider" style="display: inline; width: 150px;"
                           required="required"/>
              <span class="font-weight-bold">30</span>
          </div>
        </div>
        <br/><br/>


<!--      Menu options-->
          <div class="container">
            <div class="wrapper">
            <table cellspacing="0" cellpadding="0" border="0" class="normTbe model1 hide">
                <tbody>
                    <tr class="alonTr">
                        <td><input type="text" /></td>
                        <td><input type="text" /></td>
                        <td><input type="text" /></td>
                        <td>
    <!--                        <a href="javascript:;" class="AddTr">add</a>-->
                            <a class="text_a" href="javascript:;" onclick="deltr(this)">delete</a>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="itemInfo">
                <table cellspacing="0" cellpadding="0" border="0" class="normTbe tabInfo">
                    <thead>
                        <tr>
                            <th><label for="category">Category:</label></th>
                            <th><label for="description">Desc:</label></th>
                            <th><label for="portion">Portion:</label></th>
                            <th>action</th>
                        </tr>
                    </thead>
                    <tbody class="tbody1">
                        <tr>
                            <td><select id="category" name="category" class="form-control" action="{% url 'ajax_load_description' %}" style="display: inline; width: 150px; margin-top: 2px;">
                                <option value="">Choose One</option>
                                  {% for cat in category %}
                                    <option value="{{cat.id}}">{{cat.name}}</option>
                                  {% endfor %}
                                </select>
                            </td>
                            <td><select id="description" name="description" class="form-control" action="{% url 'ajax_load_portion' %}" style="display: inline; width: 150px; margin:10px; margin-top: 2px;">
                                <option value="">Choose One</option>
                                  {% for desc in description %}
                                    <option value="{{desc.id}}">{{desc.name}}</option>
                                  {% endfor %}
                                </select>
                            </td>
                            <td><select id="portion" name="portion" class="form-control" style="display: inline; width: 150px; margin:12px; margin-top: 2px;">
                                    <option value="">Choose One</option>
                                      {% for port in portion %}
                                        <option value="{{port.id}}">{{port.name}}</option>
                                      {% endfor %}
                                </select>
                            </td>
                            <td>
                                <a href="javascript:;" class="AddTr">add</a>
    <!--                            <a class="text_a" href="javascript:;" onclick="deltr(this)">delete</a>-->
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div><!-- itemInfo -->
            </div>
        <br>
            <div style="text-align: center;">
                <button  type="reset" class="btn btn-primary" style="margin:0 auto;">Reset</button>
                <button name="submit" id="submit" type="submit" class="btn btn-primary" style="margin:0 auto;">Submit</button>
                <br><br>
          </div>
    </div>
</form>

        <!-- END: diary form -->


<!--         BEGIN: #footer-->
        <footer id="footer">
          <div class="container">

            <!-- BEGIN: .footer-subscribe -->
            <div class="row footer-subscribe">
              <div class="col-md-6">
                <h3 class="mt-2">manage your blood sugar, join US.</h3>
              </div>
              <div class="col-md-6">
              </div>
            </div>
            <!-- END: .footer-subscribe -->

            <div class="row">
              <div class="col-md-6 col-lg-3 mb-4 mb-md-0">
                <!-- BEGIN: .widget -->
                <div class="widget">
                  <h3>About Our Team.</h3>
                </div>
                <!-- END: .widget -->
              </div>
              <div class="col-md-6 col-lg-3 mb-4 mb-md-0">
                <!-- BEGIN: .widget -->
                <div class="widget">
                  <h3>Our Motivation.</h3>
                </div>
                <!-- END: .widget -->
              </div>
              <div class="col-md-6 col-lg-3 mb-4 mb-md-0">
                <!-- BEGIN: .widget -->
                <div class="widget">
                  <h3>Our Data.</h3>
                </div>
                <!-- END: .widget -->
              </div>
              <div class="col-md-6 col-lg-3 mb-4 mb-md-0">
                <div class="d-block">
                </div>
                <div class="d-block">
                  <p>If you have any question, please contact us at <a href="#" class="link-underline text-primary">info@diatastic.tk</a></p>
                </div>
              </div>
            </div>

            <!-- BEGIN: .copyright -->
            <div class="row copyright">
              <div class="col-md-6 order-2 text-center text-md-right"><a href="#" class="js-top"><span class="icon-long-arrow-up mr-2"></span> Go to Top</a></div>
              <div class="col-md-6 text-center text-md-left">
                <p>&copy; 2022. All Rights Reserved. Design by <a href="#" target="_blank" class="link-underline text-primary">TP08</a></p>
              </div>
            </div>
            <!-- END: .copyright -->
          </div>
        </footer>
<!--         END: #footer -->

      </div>
      <!-- END: .site-wrap -->

      <!-- Loader -->
      <div id="site-overlayer"></div>
      <div class="site-loader-wrap">
        <div class="site-loader"></div>
      </div>
</body>
      <!-- BEGIN: JavaScripts -->
<script src="/static/js/jquery-3.4.1.min.js"></script>
<script src="/static/js/popper.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>
<script src="/static/js/jquery.waypoints.min.js"></script>
<script src="/static/js/jquery.animateNumber.min.js"></script>
<script src="/static/js/tiny-slider.js"></script>
<script src="/static/js/jquery.fancybox.min.js"></script>
<script src="/static/js/jquery.lavalamp.min.js"></script>
<script src="/static/js/jquery.ajaxchimp.min.js"></script>
<script src="/static/js/jquery.validate.min.js"></script>
<script src="/static/js/jquery.easing.1.3.js"></script>
<script src="/static/js/main.js"></script>

<script src="/static/js/select.js"></script>

      <!--   Core JS Files   -->
    <!--  <script src="../static/assets/plugins/jquery/jquery-3.2.1.min.js" type="text/javascript"></script>-->
<script src="/static/assets/plugins/perfect-scrollbar/js/perfect-scrollbar.jquery.min.js" type="text/javascript"></script>
<script src="/static/assets/plugins/backstretch/backstretch.js" type="text/javascript"></script>
<script src="/static/assets/js/app.js"></script>
<!--<script src="/static/add/jquery-1.11.3.min.js"></script>-->


      <!-- END: JavaScripts -->

<!--Ajax query for description dropdown.-->
<script>
    var global_cat = 0;
    var global_desc = 0;
    var global_port = 0;
    var global_quantity = 0;
    $("#category").change(function () {
      var e = document.getElementById('category');
      var url = $("#DiaryForm").attr("data-description-url");
      var categoryId = $('#category').val();
      console.log($(this).val());
      global_cat = categoryId;
      $.ajax({
        url: url,
        data: {
          'category': global_cat
        },
        success: function (data) {
            $("#description").html(data);
        }

      });

    });
  </script>

<!--Ajax query for portion description dropdown.-->
<script>
    $("#description").change(function () {
      var e = document.getElementById('description');
      var url = $("#DiaryForm").attr("data-portion-url");  // get the url of the `load_cities` view
      var descriptionId = $('#description').val();  // get the selected country ID from the HTML input
      global_desc = descriptionId;
      console.log($(this).val());
      $.ajax({                       // initialize an AJAX request
        url: url,                    // set the url of the request (= localhost:8000/hr/ajax/load-cities/)
        data: {
          'category': global_cat,
          'description': descriptionId
        },
        success: function (data) {   // `data` is the return of the `load_cities` view function
            $("#portion").html(data);  // replace the contents of the city input with the data that came from the server

        }
      });

    });
  </script>


<script>
    let range=document.querySelector("input[type=range]");
    let number=document.querySelector('input[type=number]')

    range.addEventListener("input",(e)=>{
      number.value=e.target.value;
    })
    number.addEventListener("input",(e)=>{
      range.value=e.target.value;
    })
    </script>

<script>
var cart_dict = new Array();
var csrfToken = document.getElementsByName('csrfmiddlewaretoken')[0].value;
$('#cart').click(function(e){
    e.preventDefault();

    var date = $('#date').val();
    if(date.trim() == ''){
        alert('Please check the date.');}
    else{

        var time = $('#time').val();
        if(time.trim() == ''){
            alert('Please check the time.');}
        else{

            var BSL = parseInt($('#blood_sugar_level').val());
            if(BSL != ''){
            if(BSL > 30 || BSL < 0){
                alert('Please check your Blood Sugar Levels.');}
                else{

                var categoryId = parseInt($('#category').val());
                if(!parseInt(categoryId) || categoryId == ''){
                    alert('Please check the category.');}
                else{

                    var descriptionId = parseInt($('#description').val());
                    if(!parseInt(descriptionId) || descriptionId == ''){
                        alert('Please check the description.');}
                    else{

                        var portionId = parseInt($('#portion').val());
                        if(!parseInt(portionId) || portionId == ''){
                            alert('Please check the portions.');}
                        else{

                            var Q = parseInt($('#quantity').val());
                            if(!parseInt(Q) || Q == ''){
                                alert('Please check the quantity.');}
                            else{

                                if(Q < 0){
                                    alert('Please check your quantity input.');}
                                    else{
                                    var dup = 0;
                                    if(cart_dict.length != 0){
                                        for(i = 0; i < cart_dict.length; i++){
                                            console.log((cart_dict[i]['categoryId'] == categoryId ) && (cart_dict[i]['descriptionId'] == descriptionId) && (cart_dict[i]['portionId'] == portionId));
                                            if((cart_dict[i]['categoryId'] == categoryId ) && (cart_dict[i]['descriptionId'] == descriptionId) && (cart_dict[i]['portionId'] == portionId)){
                                                dup = 1;
                                                console.log(dup);
                                                break;}
                                            }
                                        }
                                    if(dup == 1){
                                        cart_dict[i]['Q'] = cart_dict[i]['Q'] + Q;
                                                }
                                    else if(dup == 0){cart_dict.push({'date':date, 'time': time, 'BSL': BSL,
                                                                      'categoryId': categoryId, 'descriptionId': descriptionId, 'portionId': portionId,
                                                                      'Q': Q
                                                                      });
                                                }
}
}
console.log(cart_dict);
$('#category:input').val('Choose One');
$('#description:input').val('Choose One');
$('#portion:input').val('Choose One');
$('#Q').val(0);
}
}
}
}
}
}
}
});
</script>

<script>
var submit_dict = new Array();
var csrfToken = document.getElementsByName('csrfmiddlewaretoken')[0].value;
$('#submit').click(function(e){
    var date = $('#date').val();
    if(date.trim()!=''){

    var time = $('#time').val();
    if(time.trim()!=''){

    var BSL = parseInt($('#blood_sugar_level').val());
    if(BSL != ''){

    var categoryId = parseInt($('#category').val());
    if(categoryId != ''){

    var descriptionId = parseInt($('#description').val());
    if(descriptionId != ''){

    var portionId = parseInt($('#portion').val());
    if(portionId != ''){

    var Q = parseInt($('#quantity').val());
    if(Q != ''){
    {submit_dict.push({'date':date, 'time': time, 'BSL': BSL,
                       'categoryId': categoryId, 'descriptionId': descriptionId, 'portionId': portionId,
                       'Q': Q
                       });
    }
}
}
}
}
}
}
}
console.log(submit_dict);
});
</script>



<script>
var url = "{% url 'create_view' %}";
function SendCart(){
    var data = {cart_items: JSON.stringify(cart_dict), submit_items: JSON.stringify(submit_dict), csrfmiddlewaretoken: document.getElementsByName('csrfmiddlewaretoken')[0].value};
    var posting = $.post('/create_view/', data);
}
</script>

<script>
$(document).ready(function (){
    $('#submit').click(function(){
    SendCart();
    });
    });
</script>

<script>
    $(function () {
        $('.tbody1').on("click", ".alonTr .innerbtn", function () {
            $(this).next('.pop_box').slideDown('400');
        })
        $('.tbody1').on("click", ".alonTr .closepop", function () {
            $('.pop_box').slideUp('400');
        })

        // add new row
        var show_count = 20;
        var count = 1;
        $(".AddTr").click(function () {
            var length = $(".tabInfo .tbody1>tr").length;
            //alert(length);
            if (length < show_count) {
                $(".model1 tbody .alonTr").clone().appendTo(".tabInfo .tbody1");
            }
        });
    });


    function deltr(opp) {
        var length = $(".tabInfo .tbody1>tr").length;
        //alert(length);
        if (length <= 1) {
            alert("less one row");
        } else {
            $(opp).parent().parent().remove();//delete row
        }
    }
    // ----

</script>
<style>
    * {
        padding: 0px;
        margin: 0px;
        font-style: normal;
        list-style-type: none;
        text-decoration: none;
<!--            font-family: "微软雅黑";-->
        font-size: 14px;
        border: 0 none;
        line-height: 24px;
        color: #666;
    }

    table {
        table-layout: fixed;
        width: 100%;
    }

    input, button, select, textarea {
        outline: none;
        resize: none;
        padding: 3px 5px;
        border: 1px solid #ddd;
    }

        input:focus, textarea:focus {
            border: 1px solid #9ab6d6;
        }

    .whiteBg {
        background: #fff;
    }

    .normTbe {
        border-left: 1px solid #ddd;
        border-top: 1px solid #ddd;
    }

        .normTbe td, .normTbe th {
            border-bottom: 1px solid #ddd;
            border-right: 1px solid #ddd;
            padding: 15px;
            text-align: center;
        }

        .normTbe input {
            width: 80%;
            text-align: center;
        }

    .wrapper {
        width: 80%;
        padding: 0 20px;
        margin:0 auto;
        clear: both;
    }

    .hide {
        display: none;
    }

    .hideTr {
        background: #ddd;
    }

    .pop_box {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 99999;
    }

        .pop_box .bg {
            background: #000;
            opacity: 0.7;
            filter: alpha(opacity=70);
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .pop_box .contentP {
            position: relative;
            margin: 0 auto;
            margin-top: 10%;
            background: #fff;
            width: 80%;
        }

        .pop_box .PTit {
            height: 45px;
            background: #eee;
        }

            .pop_box .PTit h3 {
                line-height: 45px;
                float: left;
                padding-left: 15px;
                font-weight: normal;
                font-size: 16px;
            }

            .pop_box .PTit a {
                display: block;
                width: 45px;
                line-height: 45px;
                text-align: center;
                background: #ddd;
                float: right;
                font-size: 20px;
            }

                .pop_box .PTit a:hover {
                    background: #50abfd;
                    color: #fff;
                }

        .pop_box .textmian {
            padding: 15px;
        }

    .btn_a1 {
        padding-top: 15px;
    }

        .btn_a1 a {
            display: inline-block;
            *display: inline;
            *zoom: 1;
            width: 120px;
            line-height: 45px;
            background: #50abfd;
            color: #fff;
        }

        .btn_a1 .addtr2, .btn_a1 .dtadd {
            background: #ff9900;
        }
</style>

{% else %}
<script type="text/javascript">
    window.location.href = "/please_login/";
</script>
{% endif %}